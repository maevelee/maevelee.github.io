---
title: "SQL 실습2 - SQL 연산자, 함수"
excerpt: "SQL에서 연산자와 함수를 사용하는 방법을 알아보자."
categories:
  - lectures
tags:
  - sql
last_modified_at:
---

## 목차

- WHERE 조건 절

- 연산자
    1. 비교 연산자(1)   
     =, >, >=, <=
    2. 비교 연산자(2)  
    BETWEEN...AND..., IN(LIST), LIKE, IS NULL
    3. 논리 연산자  
    AND, OR, NOT
    4. 부정표현  
    !=, <>, NOT BETWEEN...AND..., NOT IN, NOT LIKE, IS NOT NULL

- 함수
    1. 문자함수  
    LOWER, UPPER, REPLACE, CONCAT, SUBSTRING, LENGTH, REVERSE
    2. 치환함수  
    DATE_FORMAT, TIME_FORMAT, STR_TO_DATE, CAST
    3. 숫자함수  
    ROUND, TRUNCATE, MOD, POW

함수의 경우 우리가 직접 mysql dbms에 만들어서 사용할 수도 있고, mysql에서 기본적으로 제공하는 함수를 사용할 수도 있다.  
오늘은 우선 기본 제공 함수의 사용법을 알아본다. 

## WHERE 조건 절
where 조건 절은 조건을 지정하여 값을 검색할 때 사용된다.

SELECT, UPDATE, DELETE + WHERE 원하는 조건;

```sql
SELECT ENAME, JOB
FROM EMP
WHERE JOB = 'SALESMAN';
```

그렇다면 emp table에서 comm이 null인 값을 선택하여 출력해보자.

일반적인 생각이라면 null은 값이 없다는 의미이므로, 

```sql
SELECT * FROM EMP
WHERE COMM = 0;
```
위 코드와 같이 comm 값을 0으로 놓고 찾으면 comm이 null인 값을 찾을 수 있을 것이라고 생각하지만...

사실 출력해보면 위와 같이 null값이 아니라, comm이 0으로 초기화 되어있는 값만 출력됨을 알 수 있다.

mysql에서 null항목을 가진 값을 검색하려면 무조건 **is null, is not null** 명령어를 이용하여 검색해야 한다.

```sql
SELECT * FROM EMP
WHERE COMM IS NULL;
```
위 코드와 같이 is null 명령어를 이용하자 comm이 null인 값들이 정상적으로 출력되는 것을 볼 수 있다.

## 연산자

### 비교연산자(1)
별거 없다. 그냥 연산자를 사용하면 true면 1, flase면 0을 리턴한다.

### 비교연산자(2)
- BETWEEN...AND
시작값과 끝값을 지정하여 비교하고 싶을 때 사용한다. 
예를 들어 salary가 1000~2000 사이인 값을 선택하여 출력하고 싶다면 BETWEEN...AND를 사용한다.

WHERE 컬럼명 BETWEEN 시작 값 AND 끝 값;
WHERE 컬럽 >= 값1 AND 컬럼 <= 값2 와 같은 결과가 출력된다.

```sql
SELECT * FROM EMP 
WHERE SAL BETWEEN 1000 AND 2000;

SELECT * FROM EMP
WHERE SAL >= 1000 AND <= 2000;
```

위 코드를 사용하면 위와 같은 결과가 출력되는 것을 확인할 수 있다. 

- IN(LIST)  
조건에 다수의 나열된 값을 지정하여 매칭되는 값을 추출할 때 사용한다.

WEHRE 컬럼명 IN (값1, 값2, ...);  
WHERE 컬럼명= 값1 OR 컬럼명= 값2 ...와 같은 결과가 출력된다.

부정으로 사용할 시 NOT IN(LIST)를 사용하면 된다.

```sql
SELECT ENAME, JOB
FROM EMP
WHERE JOB IN ('ANALYST', 'CLERK');

SELECT ENAME, JOB 
FROM EMP 
WHERE JOB = 'ANALYST' OR JOB = 'CLERK';
```

- LIKE  
문자열 완전 혹은 부분 매칭을 수행할때 사용된다.  
와일드 카드 기호 %와 _가 사용된다.  
%의 경우 길이 제한이 없으며, _는 개수별로 하나 씩 글자가 대응된다.

예를 들어, ename에서 A가 포함된 데이터를 찾고 싶다면,

```sql
select * from emp
where ename like '%a%';
```
라고 코드를 입력하면 된다.
위 코드의 의미는 앞뒤로 글자가 몇 개이든 상관하지 않고, a만 있으면 출력하라. 라는 의미이다.

```sql
select * from emp
where ename like '_%a';
```
라고 코드를 입력하면, a앞에 한 글자만 올 수 있고, a뒤로는 글자 길이를 상관하지 않는다.  
map, mapp, napppppp 모두 가능하다. a앞에 글자 하나만 오면 된다. 라는 의미이다.

만약 a 앞뒤로 글자 하나씩만 있는 데이터를 찾고 싶다면,

```sql
select * from emp
where ename like '_a_';
```
라고 입력하면 된다.

a 앞뒤로 글자 세 개씩 있는 데이터를 찾고 싶다면,

```sql
select * from emp
where ename like '___a___';
```
라고 입력하면 된다! 그럼 lulalul, rrrarrr, mmmammm등이 포함되겠지~?

- IS NULL

저번 실습 때에도 잠깐 언급했지만, SQL에서 NULL값을 검색하려면 논리 연산자인 '='대신 'IS NULL'을 사용하여야 한다.  
그렇지 않으면 정상적으로 값이 검색되지 않는다. 

IS NULL의 부정만은 NOT IS NULL이 아닌 **IS NOT NULL**이므로, 이 역시 주의하자!

```sql
SELECT ENAME, COMM
FROM EMP
WHERE COMM IS NULL;
```
값이 정상적으로 출력됨을 알 수 있다.

- 연산자 다중 조건 적용  
연산자 여러 개를 사용하여 다중의 조건을 적용할수도 있다.

```sql
SELECT ENAME, SAL
FROM EMP
WHERE ENAME LIKE '%A%' AND SAL > 2000;
```
위 코드를 입력하면 ENAME에 A가 들어가고 동시에 SALARY가 2000이상인 값이 출력된다.

AND와 OR을 동시에 사용할 때는 소괄호를 사용하여 연산자의 우선순위를 지정한다.

```sql
SELECT MGR, SAL
FROM EMP
WHERE MGR = 7698 OR (MGR = 7839 AND SAL > 1500);
```

위와 같이 괄호를 입력하게 되면 MGR이 7698인 사람과 MGR이 7839면서 동시에 SALARY가 1500이상인 사람이 출력된다. 

+ 연산자 예제 1)  
EMP TABLE에서 이름(ENAME)이 사전배열 상 A에서 H사이에 있는 사원의 모든 정보를 이름을 기준으로 오름차순으로 출력하라.

```sql
select * from emp 
where ename between 'a' and 'h';
```

+ 연산자 예제 2)  
EMP TABLE에서 이름(ENAME)에 알파벳 A가 포함되고 급여(SAL)이 2000이상인 사원의 모든 정보를 출력하라.

```sql
SELECT * FROM EMP
WHERE ENAME LIKE '%A%' AND SAL > 2000;
```

+ 연산자 예제 3)  
EMP 테이블에서 자신의 상관(MGR)이 없는 직책(JOB)을 출력하라. 

```sql
SELECT JOB FROM EMP WHERE MGR IS NULL;
```

## 함수
sql내장 함수를 select문을 이용하여 간단하게 출력해보자.  
실습은 select문으로 하지만, 연습할 때는 직접 db에 있는 데이터를 가져와서 출력해봐야 함!

### 문자 함수

- LOWER, LCASE  
대문자를 소문자로 변경하여 출력하는 함수.

```sql
SELECT LOWER("SQL");
SELECT LCASE("SQL");
```

- UPPER, UCASE  
소문자를 대문자로 변경하여 출력하는 함수.

```sql
SELECT UPPER("sql");
SELECT UCASE("sql");
```

- REPLACE  
특정 문자를 치환하는 함수.

```sql
SELECT REPLACE("sql is fun", "sql", "c");
```
sql is fun이라는 문장에서 sql이 c로 치환되어 c is fun이 출력된다.

- CONCAT  
문자 혹은 문자열을 결합하여 출력하는 함수.

```sql
SELECT CONCAT("sql", "is", "fun");
```
sql, is, fun 세 단어가 합쳐져 sql is fun이라는 문장이 출력된다.

- SUBSTRING, MID  
컬럼 데이터의 일부분을 반환하는 함수.

```sql
SELECT JOB, SUBSTRING(JOB, 1, 3)
FROM EMP;
```

job에서 첫 번째, 두 번째, 세 번째 글자가 반환된다, 예를 들어 job이 salesman이라면, sal이 반환된다.

- REVERSE  
입력된 문자열을 거꾸로 뒤집은 결과를 반환하는 함수.

```sql
SELECT REVERSE("sql is fun");
```

### 치환 함수

치환 함수를 쓰려면 날짜 데이터 포맷을 알아야 한다. 날짜 데이터는 대소문자를 구분한다.   

▷%Y (2020), %y (20) : 연도  
▷%M (September), %b (Sep), %m (09), %c (9) : 월  
▷%D (7th), %d (07), %e (7) : 일  
▷%W (Thursday), %a (Sun), %w(0) : 요일  
▷%H, %k (13), %h (01), %l (1) : 시  
▷%i: 분  
▷%S, %s : 초  
▷%p : AM,PM  
▷%r : “hh:mm:ssAM|PM”  
▷%T : “hh:mm:ss”  

- DATE_FORMAT  
날짜를 지정한 형식에 맞게 문자열로 변환하는 함수.

DATE_FORMAT(DATE, 'format')

```sql
SELECT DATE_FORMAT(NOW(), '%Y %M %D %W');
```

- TIME_FORMAT  
시간을 지정한 형식에 맞게 문자열로 변환하는 함수.

TIME_FORMAT(TIME, 'format')

```sql
SELECT TIME_FORMAT(NOW(), '%p %k %i %s');
```

- STR_TO_DATE  
문자(열)를 날짜 데이터로 변환하는 함수.  
날짜 포함 출력시 DATE(년-월-일) 값을 반환하며,  
시간 포함 출력시 TIME(시:분:초) 값을 반환한다.  
str이 유효하지 않은 값을 포함할 시 NULL을 반환한다. 

STR_TO_DATE('str', 'format')

```sql
SELECT STR_TO_DATE('25.09.2020 14.31', '%d.%m.%Y %H.%i);
```

- CAST  
데이터 형식을 변환하는 함수.

CAST(expression AS TYPE)

```sql
SELECT CAST(24 AS CHAR(2));
SELECT CAST('4' AS UNSIGNED);
SELECT CAST('20190927' AS DATE)
```

CAST 괄호 안의 순서를 바꾸면 오류가 난다.

### 숫자 함수

- ROUND  
정해진 형식으로 숫자를 변형하는 함수. (반올림)  
두 번째 인자+1 자릿수에서 반올림한 결과 값을 반환한다.

ROUND(숫자, 자릿수)

```sql
SELECT SAL, ROUND(SAL/100, 0)
FROM EMP;
```

- TRUNCATE  
정해진 형식으로 숫자를 변형하는 함수. (버림)  
두 번째 인자 자릿수 아래로 버린 결과 값을 반환한다.

TRUNCATE(숫자, 자릿수)

```sql
SELECT TRUNCATE(4234.19565, -1);
```

- MOD  
X를 Y로 나눈 나머지를 계산하는 함수.
첫 번째 인자를 두 번째 인자로 나눈 나머지를 계산하여 반환한다.

MOD(X, Y) => X%Y

```sql
SELECT SAL, MOD(SAL, 100) FROM EMP;
```

- POW  
X의 Y제곱을 계산하는 함수.
첫 번째 인자의 두 번째 인자 제곱을 계산한다.

```sql
SELECT SAL, POW(SAL, 2)
FROM EMP;
```

### 단일 행 함수의 중첩
함수는 중첩되어 사용할 수 있다. 이 때, 가장 깊이 있는 함수가 먼저 연산을 수행한다. 



